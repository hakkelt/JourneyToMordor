import{f as _,a as w}from"../chunks/DJyeK_jY.js";import{i as Ot}from"../chunks/CUcI-fVM.js";import{p as gt,b as S,a0 as ut,as as mt,c as o,t as N,g as u,a as bt,d as p,s as i,r,n as P,e as Tt,$ as Nt}from"../chunks/IJzeFTQ7.js";import{s as Ft,r as X,h as zt}from"../chunks/Bn5pPXlW.js";import{i as F,s as Bt,a as vt}from"../chunks/BHNDWgM0.js";import{i as Kt,b as Ht,c as Rt,e as Ut,j as qt}from"../chunks/yz4tDfHJ.js";import{b as Y,u as Jt}from"../chunks/DVyVD2ea.js";import{d as Wt,e as Qt,s as A}from"../chunks/DOjKFJ1S.js";import{e as $t}from"../chunks/BuXefRBq.js";import{p as Gt,b as Pt}from"../chunks/16avLG_6.js";const Xt=.621371;function Yt(m,e="km"){const s=[["Date",`Distance (${e})`,"Note"].join(",")],a=[...m].sort((c,h)=>c.date.localeCompare(h.date));for(const c of a){const h=e==="miles"?(c.distance*Xt).toFixed(2):c.distance.toFixed(2),y=c.note?`"${c.note.replace(/"/g,'""')}"`:"";s.push([c.date,h,y].join(","))}return s.join(`
`)}function Zt(m,e="journey-log.csv"){const l=new Blob([m],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),a=URL.createObjectURL(l);s.setAttribute("href",a),s.setAttribute("download",e),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}function ft(m){const e=[];let l=0,s=!1;for(let a=0;a<m.length;a++)m[a]==='"'?s=!s:m[a]===","&&!s&&(e.push(pt(m.substring(l,a))),l=a+1);return e.push(pt(m.substring(l))),e}function pt(m){const e=m.trim();return e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1).replace(/""/g,'"'):e}function te(m){const e=m.split(/\r?\n/).filter(d=>d.trim().length>0);if(e.length<2)throw new Error("CSV file is empty or missing headers");const l=e[0].toLowerCase(),s=ft(l),a=s.findIndex(d=>d.includes("date")),c=s.findIndex(d=>d.includes("distance")),h=s.findIndex(d=>d.includes("note"));if(a===-1||c===-1)throw new Error("Missing required columns: Date and Distance");const y=s[c].includes("miles"),j=1.60934,I=[];for(let d=1;d<e.length;d++){const k=e[d],f=ft(k);if(f.length<2)continue;const x=f[a],D=f[c],M=h!==-1?f[h]:"";if(!x||isNaN(Date.parse(x)))throw new Error(`Invalid date on line ${d+1}: ${x}`);let L=parseFloat(D);if(isNaN(L)||L<0)throw new Error(`Invalid distance on line ${d+1}: ${D}`);y&&(L=L*j),I.push({id:Date.now()+d,date:x,distance:L,note:M||void 0})}return I}var ee=_('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"><div class="w-full max-w-md rounded-lg bg-white p-6 shadow-xl"><h3 class="mb-2 text-xl font-bold text-red-600">Warning: Data Loss</h3> <p class="mb-6 text-slate-600">Are you sure you want to delete ALL log entries? This action cannot be undone.</p> <div class="flex justify-end gap-3"><button class="rounded-md border border-slate-300 px-4 py-2 font-medium text-slate-700 hover:bg-slate-50">Cancel</button> <button class="rounded-md bg-red-600 px-4 py-2 font-medium text-white hover:bg-red-700">Delete All</button></div></div></div>'),re=_('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"><div class="w-full max-w-md rounded-lg bg-white p-6 shadow-xl"><h3 class="mb-2 text-xl font-bold text-ring-600">Confirm Import</h3> <p class="mb-4 text-slate-600">Importing will <strong>replace</strong> your current history with <strong> </strong> entries.</p> <p class="mb-6 text-sm text-slate-500">Current data will be lost.</p> <div class="flex justify-end gap-3"><button class="rounded-md border border-slate-300 px-4 py-2 font-medium text-slate-700 hover:bg-slate-50">Cancel</button> <button class="rounded-md bg-ring-600 px-4 py-2 font-medium text-white hover:bg-ring-700">Import Data</button></div></div></div>'),oe=_('<button class="flex items-center gap-2 rounded-md border border-slate-300 bg-white px-3 py-1.5 font-medium transition-colors hover:bg-slate-50 hover:text-ring-600" aria-label="Download log entries as CSV"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg> Download CSV</button> <button class="flex items-center gap-2 rounded-md border border-red-200 bg-red-50 px-3 py-1.5 font-medium text-red-700 transition-colors hover:bg-red-100"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"></path></svg> Delete All</button>',1),se=_('<p class="py-4 text-center text-slate-500 italic">No entries yet. Start your journey!</p>'),ne=_('<tr><td class="py-3 text-slate-800"> </td><td class="py-3 text-slate-800"> </td><td class="py-3 text-slate-600"> </td><td class="py-3 text-right"><button aria-label="Delete entry" class="text-slate-400 transition-colors hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></button></td></tr>'),ae=_('<div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="border-b border-slate-200"><th class="pb-2 font-medium text-slate-600">Date</th><th class="pb-2 font-medium text-slate-600"> </th><th class="pb-2 font-medium text-slate-600">Note</th><th class="w-10 pb-2 font-medium text-slate-600"></th></tr></thead><tbody class="divide-y divide-earth-100"></tbody></table></div>'),ie=_('<input type="file" accept=".csv" class="hidden"/> <!> <!> <div class="space-y-8"><div class="rounded-lg border border-slate-200 bg-white p-6 shadow-sm"><h2 class="mb-4 font-serif text-3xl text-slate-800">Log Journey</h2> <form class="space-y-4"><div class="grid grid-cols-1 gap-4 md:grid-cols-2"><div><label for="date" class="mb-1 block text-sm font-medium text-slate-700">Date</label> <input type="date" id="date" required class="w-full rounded-md border-slate-300 p-3 shadow-sm focus:border-ring-500 focus:ring-ring-500"/></div> <div><label for="distance" class="mb-1 block text-sm font-medium text-slate-700"> </label> <input type="number" id="distance" step="0.01" min="0.01" required placeholder="0.00" class="w-full rounded-md border-slate-300 p-3 shadow-sm focus:border-ring-500 focus:ring-ring-500"/></div></div> <div><label for="note" class="mb-1 block text-sm font-medium text-slate-700">Note (Optional)</label> <input type="text" id="note" placeholder="Morning walk..." class="w-full rounded-md border-slate-300 p-3 shadow-sm focus:border-ring-500 focus:ring-ring-500"/></div> <button type="submit" class="mx-auto block rounded-md bg-ring-600 px-8 py-2 font-medium text-white transition-colors hover:bg-ring-700">Add Entry</button></form></div> <div class="rounded-lg border border-slate-200 bg-white p-6 shadow-sm"><div class="mb-4 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center"><h2 class="font-serif text-3xl text-slate-800">History</h2> <div class="flex flex-wrap gap-2 text-sm text-slate-700"><button class="flex items-center gap-2 rounded-md border border-slate-300 bg-white px-3 py-1.5 font-medium transition-colors hover:bg-slate-50 hover:text-ring-600"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"></path></svg> Import CSV</button> <!></div></div> <!></div></div>',1);function le(m,e){gt(e,!0);let l=Gt(e,"unit",3,"km"),s=S(ut(new Date().toISOString().split("T")[0])),a=S(null),c=S("");const h=1.60934,y=.621371;function j(t){if(t.preventDefault(),!u(a)||u(a)<=0)return;let n=u(a);l()==="miles"&&(n=u(a)*h),e.onAdd({date:u(s),distance:n,note:u(c)}),p(s,new Date().toISOString().split("T")[0],!0),p(a,null),p(c,"")}function I(t){return l()==="miles"?(t*y).toFixed(2):t.toFixed(2)}function d(){const t=Yt(e.logs,l()),n=new Date().toISOString().split("T")[0];Zt(t,`journey-to-mordor-${n}.csv`)}let k,f=S(!1),x=S(!1),D=S(ut([])),M=S(null);function L(){k.click()}async function ht(t){const n=t.target;if(!n.files||n.files.length===0)return;const g=n.files[0];try{const v=await g.text(),b=te(v);e.logs.length>0?(p(D,b,!0),p(M,null),p(x,!0)):e.onImport(b)}catch(v){console.error(v),p(M,v.message||"Failed to parse CSV",!0),alert(`Error importing CSV: ${u(M)}`)}finally{n.value=""}}function xt(){e.onImport(u(D)),p(x,!1),p(D,[],!0)}function wt(){e.onDeleteAll(),p(f,!1)}var Z=ie(),z=mt(Z);z.__change=ht,Pt(z,t=>k=t,()=>k);var tt=i(z,2);{var _t=t=>{var n=ee(),g=o(n),v=i(o(g),4),b=o(v);b.__click=()=>p(f,!1);var C=i(b,2);C.__click=wt,r(v),r(g),r(n),w(t,n)};F(tt,t=>{u(f)&&t(_t)})}var et=i(tt,2);{var yt=t=>{var n=re(),g=o(n),v=i(o(g),2),b=i(o(v),3),C=o(b,!0);r(b),P(),r(v);var O=i(v,4),V=o(O);V.__click=()=>p(x,!1);var E=i(V,2);E.__click=xt,r(O),r(g),r(n),N(()=>A(C,u(D).length)),w(t,n)};F(et,t=>{u(x)&&t(yt)})}var rt=i(et,2),B=o(rt),K=i(o(B),2),H=o(K),R=o(H),U=i(o(R),2);X(U),r(R);var ot=i(R,2),q=o(ot),kt=o(q);r(q);var st=i(q,2);X(st),r(ot),r(H);var nt=i(H,2),at=i(o(nt),2);X(at),r(nt),P(2),r(K),r(B);var it=i(B,2),J=o(it),lt=i(o(J),2),dt=o(lt);dt.__click=L;var Dt=i(dt,2);{var Lt=t=>{var n=oe(),g=mt(n);g.__click=d;var v=i(g,2);v.__click=()=>p(f,!0),w(t,n)};F(Dt,t=>{e.logs.length>0&&t(Lt)})}r(lt),r(J);var St=i(J,2);{var It=t=>{var n=se();w(t,n)},Ct=t=>{var n=ae(),g=o(n),v=o(g),b=o(v),C=i(o(b)),O=o(C);r(C),P(2),r(b),r(v);var V=i(v);$t(V,21,()=>e.logs,E=>E.id,(E,T)=>{var W=ne(),Q=o(W),At=o(Q,!0);r(Q);var $=i(Q),jt=o($);r($);var G=i($),Mt=o(G,!0);r(G);var ct=i(G),Vt=o(ct);Vt.__click=()=>e.onDelete(u(T).id),r(ct),r(W),N(Et=>{A(At,u(T).date),A(jt,`${Et??""} ${l()==="miles"?"miles":"km"}`),A(Mt,u(T).note||"-")},[()=>I(u(T).distance)]),w(E,W)}),r(V),r(g),r(n),N(()=>A(O,`Distance (${l()==="miles"?"miles":"km"})`)),w(t,n)};F(St,t=>{e.logs.length===0?t(It):t(Ct,!1)})}r(it),r(rt),N(t=>{Ft(U,"max",t),A(kt,`Distance (${l()==="miles"?"miles":"km"})`)},[()=>new Date().toISOString().split("T")[0]]),Qt("submit",K,j),Y(U,()=>u(s),t=>p(s,t)),Y(st,()=>u(a),t=>p(a,t)),Y(at,()=>u(c),t=>p(c,t)),w(m,Z),bt()}Wt(["change","click"]);var de=_("<div><!></div>");function we(m,e){gt(e,!1);const l=()=>vt(Jt,"$user",a),s=()=>vt(qt,"$journeyStore",a),[a,c]=Bt();function h(f){Ut(f,l())}function y(f){Rt(f,l())}function j(){Ht(l())}function I(f){Kt(f,l())}Ot();var d=de();zt("1lsf4ps",f=>{Tt(()=>{Nt.title="Journey Logs - Journey To Mordor"})});var k=o(d);le(k,{get logs(){return s().logs},get unit(){return s().unit},onAdd:h,onDelete:y,onDeleteAll:j,onImport:I}),r(d),w(m,d),bt(),c()}export{we as component};
