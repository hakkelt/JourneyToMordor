import{f as _,a as w}from"../chunks/Ch9GSn30.js";import{i as Ot}from"../chunks/Dbm-z3nC.js";import{p as bt,b as S,a0 as ut,as as mt,c as s,t as N,g as u,a as ht,d as f,s as i,r as o,n as P,e as Tt,$ as Nt}from"../chunks/D0sG4Gf8.js";import{s as Ft,r as X,h as zt}from"../chunks/BXtuWJMv.js";import{i as F,s as Bt,a as vt}from"../chunks/CifNh-sY.js";import{i as Kt,b as Ht,c as Rt,e as Ut,j as qt}from"../chunks/Dt4Og1kx.js";import{b as Y,u as Jt}from"../chunks/veJxXT5U.js";import{d as Wt,e as Qt,s as A}from"../chunks/BVKB6R5f.js";import{e as $t}from"../chunks/DPdWQ3k2.js";import{p as Gt,b as Pt}from"../chunks/BLxvU6kv.js";const Xt=.621371;function Yt(m,e="km"){const r=[["Date",`Distance (${e})`,"Note"].join(",")],a=[...m].sort((c,g)=>c.date.localeCompare(g.date));for(const c of a){const g=e==="miles"?(c.distance*Xt).toFixed(2):c.distance.toFixed(2),y=c.note?`"${c.note.replace(/"/g,'""')}"`:"";r.push([c.date,g,y].join(","))}return r.join(`
`)}function Zt(m,e="journey-log.csv"){const l=new Blob([m],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),a=URL.createObjectURL(l);r.setAttribute("href",a),r.setAttribute("download",e),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}function pt(m){const e=[];let l=0,r=!1;for(let a=0;a<m.length;a++)m[a]==='"'?r=!r:m[a]===","&&!r&&(e.push(ft(m.substring(l,a))),l=a+1);return e.push(ft(m.substring(l))),e}function ft(m){const e=m.trim();return e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1).replace(/""/g,'"'):e}function te(m){const e=m.split(/\r?\n/).filter(d=>d.trim().length>0);if(e.length<2)throw new Error("CSV file is empty or missing headers");const l=e[0].toLowerCase(),r=pt(l),a=r.findIndex(d=>d.includes("date")),c=r.findIndex(d=>d.includes("distance")),g=r.findIndex(d=>d.includes("note"));if(a===-1||c===-1)throw new Error("Missing required columns: Date and Distance");const y=r[c].includes("miles"),j=1.60934,I=[];for(let d=1;d<e.length;d++){const k=e[d],p=pt(k);if(p.length<2)continue;const x=p[a],D=p[c],M=g!==-1?p[g]:"";if(!x||isNaN(Date.parse(x)))throw new Error(`Invalid date on line ${d+1}: ${x}`);let L=parseFloat(D);if(isNaN(L)||L<0)throw new Error(`Invalid distance on line ${d+1}: ${D}`);y&&(L=L*j),I.push({id:Date.now()+d,date:x,distance:L,note:M||void 0})}return I}var ee=_('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"><div class="w-full max-w-md rounded-lg bg-white p-6 shadow-xl"><h3 class="mb-2 text-xl font-bold text-red-600">Warning: Data Loss</h3> <p class="mb-6 text-slate-600">Are you sure you want to delete ALL log entries? This action cannot be undone.</p> <div class="flex justify-end gap-3"><button class="rounded-md border border-slate-300 px-4 py-2 font-medium text-slate-700 hover:bg-slate-50">Cancel</button> <button class="rounded-md bg-red-600 px-4 py-2 font-medium text-white hover:bg-red-700">Delete All</button></div></div></div>'),oe=_('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"><div class="w-full max-w-md rounded-lg bg-white p-6 shadow-xl"><h3 class="mb-2 text-xl font-bold text-pumpkin-600">Confirm Import</h3> <p class="mb-4 text-slate-600">Importing will <strong>replace</strong> your current history with <strong> </strong> entries.</p> <p class="mb-6 text-sm text-slate-500">Current data will be lost.</p> <div class="flex justify-end gap-3"><button class="rounded-md border border-slate-300 px-4 py-2 font-medium text-slate-700 hover:bg-slate-50">Cancel</button> <button class="rounded-md bg-pumpkin-600 px-4 py-2 font-medium text-white hover:bg-pumpkin-700">Import Data</button></div></div></div>'),se=_('<button class="flex items-center gap-2 rounded-md border border-slate-300 bg-white px-3 py-1.5 font-medium transition-colors hover:bg-slate-50 hover:text-pumpkin-600" aria-label="Download log entries as CSV"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg> Download CSV</button> <button class="flex items-center gap-2 rounded-md border border-red-200 bg-red-50 px-3 py-1.5 font-medium text-red-700 transition-colors hover:bg-red-100"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"></path></svg> Delete All</button>',1),re=_('<p class="py-4 text-center text-slate-500 italic">No entries yet. Start your journey!</p>'),ne=_('<tr><td class="py-3 text-slate-800"> </td><td class="py-3 text-slate-800"> </td><td class="py-3 text-slate-600"> </td><td class="py-3 text-right"><button aria-label="Delete entry" class="text-slate-400 transition-colors hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></button></td></tr>'),ae=_('<div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="border-b border-slate-200"><th class="pb-2 font-medium text-slate-600">Date</th><th class="pb-2 font-medium text-slate-600"> </th><th class="pb-2 font-medium text-slate-600">Note</th><th class="w-10 pb-2 font-medium text-slate-600"></th></tr></thead><tbody class="divide-y divide-slate-100"></tbody></table></div>'),ie=_('<input type="file" accept=".csv" class="hidden"/> <!> <!> <div class="space-y-8"><div class="rounded-lg border border-slate-200 bg-white p-6 shadow-sm"><h2 class="mb-4 font-serif text-2xl text-slate-800">Log Journey</h2> <form class="space-y-4"><div class="grid grid-cols-1 gap-4 md:grid-cols-2"><div><label for="date" class="mb-1 block text-sm font-medium text-slate-700">Date</label> <input type="date" id="date" required class="w-full rounded-md border-slate-300 p-3 shadow-sm focus:border-pumpkin-500 focus:ring-pumpkin-500"/></div> <div><label for="distance" class="mb-1 block text-sm font-medium text-slate-700"> </label> <input type="number" id="distance" step="0.01" min="0.01" required placeholder="0.00" class="w-full rounded-md border-slate-300 p-3 shadow-sm focus:border-pumpkin-500 focus:ring-pumpkin-500"/></div></div> <div><label for="note" class="mb-1 block text-sm font-medium text-slate-700">Note (Optional)</label> <input type="text" id="note" placeholder="Morning walk..." class="w-full rounded-md border-slate-300 p-3 shadow-sm focus:border-pumpkin-500 focus:ring-pumpkin-500"/></div> <button type="submit" class="mx-auto block rounded-md bg-pumpkin-600 px-8 py-2 font-medium text-white transition-colors hover:bg-pumpkin-700">Add Entry</button></form></div> <div class="rounded-lg border border-slate-200 bg-white p-6 shadow-sm"><div class="mb-4 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center"><h2 class="font-serif text-2xl text-slate-800">History</h2> <div class="flex flex-wrap gap-2 text-sm text-slate-700"><button class="flex items-center gap-2 rounded-md border border-slate-300 bg-white px-3 py-1.5 font-medium transition-colors hover:bg-slate-50 hover:text-pumpkin-600"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"></path></svg> Import CSV</button> <!></div></div> <!></div></div>',1);function le(m,e){bt(e,!0);let l=Gt(e,"unit",3,"km"),r=S(ut(new Date().toISOString().split("T")[0])),a=S(null),c=S("");const g=1.60934,y=.621371;function j(t){if(t.preventDefault(),!u(a)||u(a)<=0)return;let n=u(a);l()==="miles"&&(n=u(a)*g),e.onAdd({date:u(r),distance:n,note:u(c)}),f(r,new Date().toISOString().split("T")[0],!0),f(a,null),f(c,"")}function I(t){return l()==="miles"?(t*y).toFixed(2):t.toFixed(2)}function d(){const t=Yt(e.logs,l()),n=new Date().toISOString().split("T")[0];Zt(t,`journey-to-mordor-${n}.csv`)}let k,p=S(!1),x=S(!1),D=S(ut([])),M=S(null);function L(){k.click()}async function gt(t){const n=t.target;if(!n.files||n.files.length===0)return;const b=n.files[0];try{const v=await b.text(),h=te(v);e.logs.length>0?(f(D,h,!0),f(M,null),f(x,!0)):e.onImport(h)}catch(v){console.error(v),f(M,v.message||"Failed to parse CSV",!0),alert(`Error importing CSV: ${u(M)}`)}finally{n.value=""}}function xt(){e.onImport(u(D)),f(x,!1),f(D,[],!0)}function wt(){e.onDeleteAll(),f(p,!1)}var Z=ie(),z=mt(Z);z.__change=gt,Pt(z,t=>k=t,()=>k);var tt=i(z,2);{var _t=t=>{var n=ee(),b=s(n),v=i(s(b),4),h=s(v);h.__click=()=>f(p,!1);var C=i(h,2);C.__click=wt,o(v),o(b),o(n),w(t,n)};F(tt,t=>{u(p)&&t(_t)})}var et=i(tt,2);{var yt=t=>{var n=oe(),b=s(n),v=i(s(b),2),h=i(s(v),3),C=s(h,!0);o(h),P(),o(v);var O=i(v,4),V=s(O);V.__click=()=>f(x,!1);var E=i(V,2);E.__click=xt,o(O),o(b),o(n),N(()=>A(C,u(D).length)),w(t,n)};F(et,t=>{u(x)&&t(yt)})}var ot=i(et,2),B=s(ot),K=i(s(B),2),H=s(K),R=s(H),U=i(s(R),2);X(U),o(R);var st=i(R,2),q=s(st),kt=s(q);o(q);var rt=i(q,2);X(rt),o(st),o(H);var nt=i(H,2),at=i(s(nt),2);X(at),o(nt),P(2),o(K),o(B);var it=i(B,2),J=s(it),lt=i(s(J),2),dt=s(lt);dt.__click=L;var Dt=i(dt,2);{var Lt=t=>{var n=se(),b=mt(n);b.__click=d;var v=i(b,2);v.__click=()=>f(p,!0),w(t,n)};F(Dt,t=>{e.logs.length>0&&t(Lt)})}o(lt),o(J);var St=i(J,2);{var It=t=>{var n=re();w(t,n)},Ct=t=>{var n=ae(),b=s(n),v=s(b),h=s(v),C=i(s(h)),O=s(C);o(C),P(2),o(h),o(v);var V=i(v);$t(V,21,()=>e.logs,E=>E.id,(E,T)=>{var W=ne(),Q=s(W),At=s(Q,!0);o(Q);var $=i(Q),jt=s($);o($);var G=i($),Mt=s(G,!0);o(G);var ct=i(G),Vt=s(ct);Vt.__click=()=>e.onDelete(u(T).id),o(ct),o(W),N(Et=>{A(At,u(T).date),A(jt,`${Et??""} ${l()==="miles"?"miles":"km"}`),A(Mt,u(T).note||"-")},[()=>I(u(T).distance)]),w(E,W)}),o(V),o(b),o(n),N(()=>A(O,`Distance (${l()==="miles"?"miles":"km"})`)),w(t,n)};F(St,t=>{e.logs.length===0?t(It):t(Ct,!1)})}o(it),o(ot),N(t=>{Ft(U,"max",t),A(kt,`Distance (${l()==="miles"?"miles":"km"})`)},[()=>new Date().toISOString().split("T")[0]]),Qt("submit",K,j),Y(U,()=>u(r),t=>f(r,t)),Y(rt,()=>u(a),t=>f(a,t)),Y(at,()=>u(c),t=>f(c,t)),w(m,Z),ht()}Wt(["change","click"]);var de=_("<div><!></div>");function we(m,e){bt(e,!1);const l=()=>vt(Jt,"$user",a),r=()=>vt(qt,"$journeyStore",a),[a,c]=Bt();function g(p){Ut(p,l())}function y(p){Rt(p,l())}function j(){Ht(l())}function I(p){Kt(p,l())}Ot();var d=de();zt("1lsf4ps",p=>{Tt(()=>{Nt.title="Journey Logs - Journey To Mordor"})});var k=s(d);le(k,{get logs(){return r().logs},get unit(){return r().unit},onAdd:g,onDelete:y,onDeleteAll:j,onImport:I}),o(d),w(m,d),ht(),c()}export{we as component};
