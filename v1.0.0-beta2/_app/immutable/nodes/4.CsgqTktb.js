import{f as D,a as x,b as Lt,t as wt}from"../chunks/oQvJ08_9.js";import{i as Wt}from"../chunks/BOJ1tbYF.js";import{p as It,d as A,a6 as yt,ao as Qt,g as d,h as u,f as St,c as r,t as F,a as Ct,s as n,r as e,n as ot,e as Yt,$ as Gt}from"../chunks/Cszbqulu.js";import{s as Xt,r as at,h as Zt}from"../chunks/4g5tVcff.js";import{a as H,s as At}from"../chunks/ByVlSEKy.js";import{i as te,h as ee,b as re,c as se,e as oe,f as ae,j as ne}from"../chunks/DsnBxUfA.js";import{b as nt,u as Mt}from"../chunks/ii3v1BhZ.js";import{d as le,e as ie,s as N}from"../chunks/BZoQOtPd.js";import{i as j}from"../chunks/DMZUN15h.js";import{e as de}from"../chunks/CM4FycmU.js";import{s as ce}from"../chunks/BjAbSHct.js";import{p as ue,b as ve}from"../chunks/BAjmNCzn.js";const me=.621371;function fe(m,s="km"){const a=[["Date",`Distance (${s})`,"Note"].join(",")],c=[...m].sort((f,y)=>f.date.localeCompare(y.date));for(const f of c){const y=s==="miles"?(f.distance*me).toFixed(2):f.distance.toFixed(2),_=f.note?`"${f.note.replace(/"/g,'""')}"`:"";a.push([f.date,y,_].join(","))}return a.join(`
`)}function pe(m,s="journey-log.csv"){const h=new Blob([m],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),c=URL.createObjectURL(h);a.setAttribute("href",c),a.setAttribute("download",s),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(c)}function kt(m){const s=[];let h=0,a=!1;for(let c=0;c<m.length;c++)m[c]==='"'?a=!a:m[c]===","&&!a&&(s.push(Dt(m.substring(h,c))),h=c+1);return s.push(Dt(m.substring(h))),s}function Dt(m){const s=m.trim();return s.startsWith('"')&&s.endsWith('"')?s.slice(1,-1).replace(/""/g,'"'):s}function he(m){const s=m.split(/\r?\n/).filter(l=>l.trim().length>0);if(s.length<2)throw new Error("CSV file is empty or missing headers");const h=s[0].toLowerCase(),a=kt(h),c=a.findIndex(l=>l.includes("date")),f=a.findIndex(l=>l.includes("distance")),y=a.findIndex(l=>l.includes("note"));if(c===-1||f===-1)throw new Error("Missing required columns: Date and Distance");const _=a[f].includes("miles"),L=1.60934,w=[];for(let l=1;l<s.length;l++){const $=s[l],g=kt($);if(g.length<2)continue;const V=g[c],K=g[f],J=y!==-1?g[y]:"";if(!V||isNaN(Date.parse(V)))throw new Error(`Invalid date on line ${l+1}: ${V}`);let S=parseFloat(K);if(isNaN(S)||S<0)throw new Error(`Invalid distance on line ${l+1}: ${K}`);_&&(S=S*L),w.push({id:Date.now()+l,date:V,distance:S,note:J||void 0})}return w}var ge=D('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"><div class="w-full max-w-md rounded-lg bg-white p-6 shadow-xl"><h3 class="mb-2 text-xl font-bold text-red-600">Warning: Data Loss</h3> <p class="mb-6 text-slate-600">Are you sure you want to delete ALL log entries? This action cannot be undone.</p> <div class="flex justify-end gap-3"><button class="rounded-md border border-slate-300 px-4 py-2 font-medium text-slate-700 hover:bg-slate-50">Cancel</button> <button class="rounded-md bg-red-600 px-4 py-2 font-medium text-white hover:bg-red-700">Delete All</button></div></div></div>'),be=D('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"><div class="w-full max-w-md rounded-lg bg-white p-6 shadow-xl"><h3 class="mb-2 text-xl font-bold text-ring-600">Confirm Import</h3> <p class="mb-4 text-slate-600">Importing will <strong>replace</strong> your current history with <strong> </strong> entries.</p> <p class="mb-6 text-sm text-slate-500">Current data will be lost.</p> <div class="flex justify-end gap-3"><button class="rounded-md border border-slate-300 px-4 py-2 font-medium text-slate-700 hover:bg-slate-50">Cancel</button> <button class="rounded-md bg-ring-600 px-4 py-2 font-medium text-white hover:bg-ring-700">Import Data</button></div></div></div>'),xe=Lt('<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z" clip-rule="evenodd"></path>'),_e=Lt('<path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm1.23-3.723a.75.75 0 00.219-.53V2.929a.75.75 0 00-1.5 0V5.36l-.31-.31A7 7 0 003.239 8.188a.75.75 0 101.448.389A5.5 5.5 0 0113.89 6.11l.311.31h-2.432a.75.75 0 000 1.5h4.243a.75.75 0 00.53-.219z" clip-rule="evenodd"></path>'),we=D('<div><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-5 w-5"><!></svg> <p class="text-sm font-medium"><!></p></div></div>'),ye=D('<button class="flex items-center gap-2 rounded-md border border-slate-300 bg-white px-3 py-1.5 font-medium transition-colors hover:bg-slate-50 hover:text-ring-600" aria-label="Download log entries as CSV"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg> Download CSV</button> <button class="flex items-center gap-2 rounded-md border border-red-200 bg-red-50 px-3 py-1.5 font-medium text-red-700 transition-colors hover:bg-red-100"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"></path></svg> Delete All</button>',1),Se=D('<p class="py-4 text-center text-slate-500 italic">No entries yet. Start your journey!</p>'),ke=D('<tr><td class="py-3 text-slate-800"> </td><td class="py-3 text-slate-800"> </td><td class="py-3 text-slate-600"> </td><td class="py-3 text-right"><button aria-label="Delete entry" class="text-slate-400 transition-colors hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></button></td></tr>'),De=D('<div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="border-b border-slate-200"><th class="pb-2 font-medium text-slate-600">Date</th><th class="pb-2 font-medium text-slate-600"> </th><th class="pb-2 font-medium text-slate-600">Note</th><th class="w-10 pb-2 font-medium text-slate-600"></th></tr></thead><tbody class="divide-y divide-earth-100"></tbody></table></div>'),Le=D('<input type="file" accept=".csv" class="hidden"/> <!> <!> <div class="space-y-8"><!> <div class="rounded-lg border border-slate-200 bg-white p-6 shadow-sm"><h2 class="mb-4 font-serif text-3xl text-slate-800">Log Journey</h2> <form class="space-y-4"><div class="grid grid-cols-1 gap-4 md:grid-cols-2"><div><label for="date" class="mb-1 block text-sm font-medium text-slate-700">Date</label> <input type="date" id="date" required class="w-full rounded-md border-slate-300 p-3 shadow-sm focus:border-ring-500 focus:ring-ring-500"/></div> <div><label for="distance" class="mb-1 block text-sm font-medium text-slate-700"> </label> <input type="number" id="distance" step="0.01" min="0.01" required placeholder="0.00" class="w-full rounded-md border-slate-300 p-3 shadow-sm focus:border-ring-500 focus:ring-ring-500"/></div></div> <div><label for="note" class="mb-1 block text-sm font-medium text-slate-700">Note (Optional)</label> <input type="text" id="note" placeholder="Morning walk..." class="w-full rounded-md border-slate-300 p-3 shadow-sm focus:border-ring-500 focus:ring-ring-500"/></div> <button type="submit" class="mx-auto block rounded-md bg-ring-600 px-8 py-2 font-medium text-white transition-colors hover:bg-ring-700">Add Entry</button></form></div> <div class="rounded-lg border border-slate-200 bg-white p-6 shadow-sm"><div class="mb-4 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center"><h2 class="font-serif text-3xl text-slate-800">History</h2> <div class="flex flex-wrap gap-2 text-sm text-slate-700"><button class="flex items-center gap-2 rounded-md border border-slate-300 bg-white px-3 py-1.5 font-medium transition-colors hover:bg-slate-50 hover:text-ring-600"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"></path></svg> Import CSV</button> <!></div></div> <!></div></div>',1);function Ie(m,s){It(s,!0);const h=()=>H(Mt,"$user",f),a=()=>H(te,"$isOnline",f),c=()=>H(ee,"$hasPendingSync",f),[f,y]=At();let _=ue(s,"unit",3,"km"),L=A(yt(new Date().toISOString().split("T")[0])),w=A(null),l=A("");const $=1.60934,g=.621371;function V(t){if(t.preventDefault(),!d(w)||d(w)<=0)return;let o=d(w);_()==="miles"&&(o=d(w)*$),s.onAdd({date:d(L),distance:o,note:d(l)}),u(L,new Date().toISOString().split("T")[0],!0),u(w,null),u(l,"")}function K(t){return _()==="miles"?(t*g).toFixed(2):t.toFixed(2)}function J(){const t=fe(s.logs,_()),o=new Date().toISOString().split("T")[0];pe(t,`journey-to-mordor-${o}.csv`)}let S,R=A(!1),U=A(!1),q=A(yt([])),P=A(null);function jt(){S.click()}async function Vt(t){const o=t.target;if(!o.files||o.files.length===0)return;const v=o.files[0];try{const i=await v.text(),b=he(i);s.logs.length>0?(u(q,b,!0),u(P,null),u(U,!0)):s.onImport(b)}catch(i){console.error(i),u(P,i.message||"Failed to parse CSV",!0),alert(`Error importing CSV: ${d(P)}`)}finally{o.value=""}}function Tt(){s.onImport(d(q)),u(U,!1),u(q,[],!0)}function Ot(){s.onDeleteAll(),u(R,!1)}let T=A(!1),lt=0,O;Qt(()=>{const t=h()&&a()&&c();if(O&&(clearTimeout(O),O=void 0),t)d(T)||(u(T,!0),lt=Date.now());else if(d(T))if(!a())u(T,!1);else{const o=Date.now()-lt,v=Math.max(0,3e3-o);O=setTimeout(()=>{c()||u(T,!1)},v)}return()=>{O&&clearTimeout(O)}});var it=Le(),W=St(it);W.__change=Vt,ve(W,t=>S=t,()=>S);var dt=n(W,2);{var Et=t=>{var o=ge(),v=r(o),i=n(r(v),4),b=r(i);b.__click=()=>u(R,!1);var I=n(b,2);I.__click=Ot,e(i),e(v),e(o),x(t,o)};j(dt,t=>{d(R)&&t(Et)})}var ct=n(dt,2);{var zt=t=>{var o=be(),v=r(o),i=n(r(v),2),b=n(r(i),3),I=r(b,!0);e(b),ot(),e(i);var E=n(i,4),C=r(E);C.__click=()=>u(U,!1);var M=n(C,2);M.__click=Tt,e(E),e(v),e(o),F(()=>N(I,d(q).length)),x(t,o)};j(ct,t=>{d(U)&&t(zt)})}var ut=n(ct,2),vt=r(ut);{var Nt=t=>{var o=we(),v=r(o),i=r(v),b=r(i);{var I=p=>{var k=xe();x(p,k)},E=p=>{var k=_e();x(p,k)};j(b,p=>{a()?p(E,!1):p(I)})}e(i);var C=n(i,2),M=r(C);{var z=p=>{var k=wt("You are currently offline. Changes will be saved locally and synced when you reconnect.");x(p,k)},B=p=>{var k=wt("Syncing changes...");x(p,k)};j(M,p=>{a()?p(B,!1):p(z)})}e(C),e(v),e(o),F(()=>ce(o,1,`mx-auto max-w-4xl rounded-md border p-4 ${a()?"border-amber-200 bg-amber-50 text-amber-800":"border-slate-200 bg-slate-100 text-slate-700"}`)),x(t,o)};j(vt,t=>{h()&&(!a()||d(T))&&t(Nt)})}var Q=n(vt,2),Y=n(r(Q),2),G=r(Y),X=r(G),Z=n(r(X),2);at(Z),e(X);var mt=n(X,2),tt=r(mt),$t=r(tt);e(tt);var ft=n(tt,2);at(ft),e(mt),e(G);var pt=n(G,2),ht=n(r(pt),2);at(ht),e(pt),ot(2),e(Y),e(Q);var gt=n(Q,2),et=r(gt),bt=n(r(et),2),xt=r(bt);xt.__click=jt;var Bt=n(xt,2);{var Ft=t=>{var o=ye(),v=St(o);v.__click=J;var i=n(v,2);i.__click=()=>u(R,!0),x(t,o)};j(Bt,t=>{s.logs.length>0&&t(Ft)})}e(bt),e(et);var Ht=n(et,2);{var Kt=t=>{var o=Se();x(t,o)},Rt=t=>{var o=De(),v=r(o),i=r(v),b=r(i),I=n(r(b)),E=r(I);e(I),ot(2),e(b),e(i);var C=n(i);de(C,21,()=>s.logs,M=>M.id,(M,z)=>{var B=ke(),p=r(B),k=r(p,!0);e(p);var rt=n(p),Ut=r(rt);e(rt);var st=n(rt),qt=r(st,!0);e(st);var _t=n(st),Jt=r(_t);Jt.__click=()=>s.onDelete(d(z).id),e(_t),e(B),F(Pt=>{N(k,d(z).date),N(Ut,`${Pt??""} ${_()==="miles"?"miles":"km"}`),N(qt,d(z).note||"-")},[()=>K(d(z).distance)]),x(M,B)}),e(C),e(v),e(o),F(()=>N(E,`Distance (${_()==="miles"?"miles":"km"})`)),x(t,o)};j(Ht,t=>{s.logs.length===0?t(Kt):t(Rt,!1)})}e(gt),e(ut),F(t=>{Xt(Z,"max",t),N($t,`Distance (${_()==="miles"?"miles":"km"})`)},[()=>new Date().toISOString().split("T")[0]]),ie("submit",Y,V),nt(Z,()=>d(L),t=>u(L,t)),nt(ft,()=>d(w),t=>u(w,t)),nt(ht,()=>d(l),t=>u(l,t)),x(m,it),Ct(),y()}le(["change","click"]);var Ce=D("<div><!></div>");function He(m,s){It(s,!1);const h=()=>H(Mt,"$user",c),a=()=>H(ne,"$journeyStore",c),[c,f]=At();function y(g){ae(g,h())}function _(g){oe(g,h())}function L(){se(h())}function w(g){re(g,h())}Wt();var l=Ce();Zt("1lsf4ps",g=>{Yt(()=>{Gt.title="Journey Logs - Journey To Mordor"})});var $=r(l);Ie($,{get logs(){return a().logs},get unit(){return a().unit},onAdd:y,onDelete:_,onDeleteAll:L,onImport:w}),e(l),x(m,l),Ct(),f()}export{He as component};
